                        http://www.apache.org/licenses/
                      /
                0x9DC20:        jmp             0x2005a0
                0x9DC25:        int3
                0x9DC26:        int3
                0x9DC27:        int3
                Function in memory:
                Function on disk:
          Derivative Works a copy of this License
          as modifying the License.
          as part of the Derivative Works
          do not modify the License. You may add Your own attribution
          excluding those notices that do not pertain to any part of
          include a readable copy of the attribution notices contained
          of the NOTICE file are for informational purposes only and
          of the following places: within a NOTICE text file distributed
          stating that You changed the files
          that such additional attribution notices cannot be construed
          the Derivative Works
          wherever such third-party notices normally appear. The contents
        C:
        [
       http://www.apache.org/licenses/LICENSE-2.0
      (a) You must give any other recipients of the Work or
      (an example is provided in the Appendix below).
      (b) You must cause any modified files to carry prominent notices
      <AdditionalIncludeDirectories>$(SolutionDir)capstone-5.0.3
      <Configuration>Debug</Configuration>
      <Configuration>Release</Configuration>
      <ConformanceMode>true</ConformanceMode>
      <EnableCOMDATFolding>true</EnableCOMDATFolding>
      <Extensions>cpp
      <Extensions>h
      <Extensions>rc
      <Filter>File di intestazione</Filter>
      <Filter>File di origine</Filter>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <GenerateDebugInformation>true</GenerateDebugInformation>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <OptimizeReferences>true</OptimizeReferences>
      <Platform>Win32</Platform>
      <Platform>x64</Platform>
      <PreprocessorDefinitions>NDEBUG
      <PreprocessorDefinitions>WIN32
      <PreprocessorDefinitions>_DEBUG
      <Project>{5b01d900-2359-44ca-9914-6b0c6afb7be7}</Project>
      <SDLCheck>true</SDLCheck>
      <SubSystem>Console</SubSystem>
      <UniqueIdentifier>{4FC737F1-C7A5-4376-A066-2A32D752A2FF}</UniqueIdentifier>
      <UniqueIdentifier>{67DA6AB6-F800-4c08-8B7A-83BB121AAD01}</UniqueIdentifier>
      <UniqueIdentifier>{93995380-89BD-4b04-88EB-625FBE52EBFB}</UniqueIdentifier>
      <WarningLevel>Level3</WarningLevel>
      <WarningLevel>Level4</WarningLevel>
      Contribution(s) alone or by combination of their Contribution(s)
      PARTICULAR PURPOSE. You are solely responsible for determining the
      Work and such Derivative Works in Source or Object form.
      You may add Your own copyright statement to Your modifications and
      and conversions to other media types.
      and distribution as defined by Sections 1 through 9 of this document.
      any Contribution intentionally submitted for inclusion in the Work
      appropriateness of using or redistributing the Work and assume any
      as of the date such litigation is filed.
      by You to the Licensor shall be under the terms and conditions of
      by such Contributor that are necessarily infringed by their
      comment syntax for the file format. We also recommend that a
      copyright notice that is included in or attached to the work
      cross-claim or counterclaim in a lawsuit) alleging that the Work
      except as required for reasonable and customary use in describing the
      excluding communication that is conspicuously marked or otherwise
      exercising permissions granted by this License.
      file or class name and description of purpose be included on the
      granted to You under this License for that Work shall terminate
      has been advised of the possibility of such damages.
      identification within third-party archives.
      institute patent litigation against any entity (including a
      may provide additional or different license terms and conditions
      meet the following conditions:
      of your accepting any such warranty or additional liability.
      on behalf of whom a Contribution has been received by Licensor and
      or a Contribution incorporated within the Work constitutes direct
      or by an individual or Legal Entity authorized to submit on behalf of
      or other liability obligations and/or rights consistent with this
      origin of the Work and reproducing the content of the NOTICE file.
      replaced with your own identifying information. (Don't include
      result of this License or out of the use or inability to use the
      risks associated with Your exercise of permissions under this License.
      submitted to Licensor for inclusion in the Work by the copyright owner
      subsequently incorporated within the Work.
      the Work and Derivative Works thereof.
      the brackets!)  The text should be enclosed in the appropriate
      the conditions stated in this License.
      the copyright owner that is granting the License.
      the original version of the Work and any modifications or additions
      the terms of any separate license agreement you may have executed
      unless required by applicable law (such as deliberate and grossly
      where such license applies only to those patent claims licensable
      with Licensor regarding such Contributions.
      with the Work to which such Contribution(s) was submitted. If You
    </ClCompile>
    </ClInclude>
    </Filter>
    </Link>
    </ProjectConfiguration>
    </ProjectReference>
    <CharacterSet>Unicode</CharacterSet>
    <ClCompile>
    <ConfigurationType>Application</ConfigurationType>
    <Keyword>Win32Proj</Keyword>
    <Link>
    <PlatformToolset>v143</PlatformToolset>
    <ProjectGuid>{ce613fc8-3f97-4989-bc90-2027463ea37d}</ProjectGuid>
    <RootNamespace>HookSentry</RootNamespace>
    <UseDebugLibraries>false</UseDebugLibraries>
    <UseDebugLibraries>true</UseDebugLibraries>
    <VCProjectVersion>17.0</VCProjectVersion>
    <WholeProgramOptimization>true</WholeProgramOptimization>
    <WindowsTargetPlatformVersion>10.0</WindowsTargetPlatformVersion>
   1. Definitions.
   2. Grant of Copyright License. Subject to the terms and conditions of
   3. Grant of Patent License. Subject to the terms and conditions of
   4. Redistribution. You may reproduce and distribute copies of the
   6. Trademarks. This License does not grant permission to use the trade
   7. Disclaimer of Warranty. Unless required by applicable law or
   9. Accepting Warranty or Additional Liability. While redistributing
   APPENDIX: How to apply the Apache License to your work.
   Copyright [yyyy] [name of copyright owner]
   END OF TERMS AND CONDITIONS
   See the License for the specific language governing permissions and
   You may obtain a copy of the License at
   limitations under the License.
   you may not use this file except in compliance with the License.
  // Skip this DLL and move to the next one
  </ImportGroup>
  </ItemDefinitionGroup>
  </ItemGroup>
  </PropertyGroup>
  <ItemGroup>
 !tools/packages.config
 (https://github.com/github/gitignore/pull/1529
 (https://github.com/github/gitignore/pull/2483
 .NET Core
 1) 
 1])
 ASP.NET Scaffolding
 Auto detect text files and perform LF normalization
 AxoCover is a Code Coverage Tool
 Azure Stream Analytics local run output
 Backup 
 Backup folder for Package Reference Convert tool in Visual Studio 2017
 BeatPulse healthcheck temp database
 Benchmark Results
 BizTalk build output
 Build Results of an ATL Project
 Build results
 Business Intelligence projects
 Cake - Uncomment if you are using it
 Chutzpah Test files
 Click-Once directory
 CodeRush personal settings
 DocProject is a documentation generator add-in
 DotCover is a Code Coverage Tool
 Example
 FAKE - F
 Files built by Visual Studio
 Files/
 Fody - auto-generated XML schema
 Get latest from https://github.com/github/gitignore/blob/main/VisualStudio.gitignore
 GhostDoc plugin setting file
 Guidance Automation Toolkit
 HookSentry
 Including strong name files can present a security risk
 Installshield output folder
 Ionide (cross platform F
 JetBrains Rider
 LPDLL_INFO
 LPSUMMARY_TABLE
 LPSUMMARY_TABLE_ROW
 Local History for Visual Studio
 Local History for Visual Studio Code
 MFractors (Xamarin productivity tool) working folder
 MSBuild Binary and Structured Log
 MSTest test Results
 Make
 Microsoft Azure Build Output
 Microsoft Azure Emulator
 Microsoft Azure Web App publish settings. Comment the next line if you want to
 Microsoft Fakes
 MightyMoose
 Mono auto generated files
 NCrunch
 NUnit
 NVidia Nsight GPU debugger configuration file
 Node.js Tools for Visual Studio
 NuGet Packages
 NuGet Symbol Packages
 NuGet v3's project.json files produces more ignorable files
 OpenCover UI analysis results
 Others
 Paket dependency manager
 Publish Web Output
 Python Tools for Visual Studio (PTVS)
 RIA/Silverlight projects
 RVA)
 ReSharper is a .NET coding add-in
 SQL Server files
 SUMMARY 
 StyleCop
 TFS 2012 Local Workspace
 TODO
 Tabs Studio
 TeamCity is a build add-in
 Telerik's JustMock configuration file
 The packages folder can be ignored because of Package Restore
 Uncomment if necessary however generally it will be regenerated when needed
 Uncomment if you have tasks that create the project's static files in wwwroot
 Usage
 User-specific files
 User-specific files (MonoDevelop/Xamarin Studio)
 VS Code files for those working on multiple tools
 VS Code tools) working folder
 Visual C
 Visual Studio 2015/2017 cache/options directory
 Visual Studio 2017 auto generated files
 Visual Studio 6 auto-generated project file (contains which files were open etc.)
 Visual Studio 6 auto-generated workspace file (contains which files were open etc.)
 Visual Studio 6 build log
 Visual Studio 6 technical files
 Visual Studio 6 workspace and project file (working project files containing files to include in project)
 Visual Studio 6 workspace options file
 Visual Studio History (VSHistory) files
 Visual Studio LightSwitch build output
 Visual Studio Trace Files
 Visual Studio Version 17
 Visual Studio cache files
 Visual Studio code coverage results
 Visual Studio profiler
 Web workbench (sass)
 Windows Installer files from build outputs
 Windows Store app package directories and files
 _  _ 
 _  _ _
 and
 argv[])
 because we have git 
 but database connection strings (with potential passwords) will be unencrypted
 but keep track of directories ending in .cache
 cache files
 count
 count < pidListSize
 dwFileLen != dwNumberOfBytesRead)
 files ending in .cache can be ignored
 files generated by popular Visual Studio add-ons.
 hFile == INVALID_HANDLE_VALUE)
 i < argc
 i < lpSummaryTable->RowsCount
 i < ntHeaders->FileHeader.NumberOfSections
 i <= size
 i))
 in these scripts will be unencrypted
 insn
 j < count
 j < row->DllsCount
 k < row->DllsCount
 ldr)
 ldrEntry)
 pid == 0)
 pid > 0)
 report files from converting an old project file
 rva < sectionAddress 
 sectionHeader->PointerToRawData
 sectionSize)
 sizeof(DLL_INFO))
 sizeof(SUMMARY_TABLE_ROW))
 text=auto
 tools/
 within the Source form or
!.axoCover/settings.json
!.vscode/extensions.json
!.vscode/launch.json
!.vscode/settings.json
!.vscode/tasks.json
"                           Version 2.0, January 2004"
"                0x9DC20:        mov             r10, rcx"
"                0x9DC23:        mov             eax, 0x3a"
"          attribution notices from the Source form of the Work,"
"          distribution, then any Derivative Works that You distribute must"
"          documentation, if provided along with the Derivative Works"
"          notices within Derivative Works that You distribute, alongside"
"          or as an addendum to the NOTICE text from the Work, provided"
"          pertain to any part of the Derivative Works, in at least one"
"          that You distribute, all copyright, patent, trademark, and"
"          within a display generated by the Derivative Works, if and"
"          within such NOTICE file, excluding those notices that do not"
"        -a, --all: Analyze all active processes"
"        -d, --disass: Display disassembled code"
"        -h, --help: Show this message"
"        -p <PID>, --pid <PID>: Analyze the process with PID <PID>"
"        -v, --verbose: Enable verbose output"
"      ""Contribution"" shall mean any work of authorship, including"
"      ""Contributor"" shall mean Licensor and any individual or Legal Entity"
"      ""Derivative Works"" shall mean any work, whether in Source or Object"
"      ""Legal Entity"" shall mean the union of the acting entity and all"
"      ""License"" shall mean the terms and conditions for use, reproduction,"
"      ""Licensor"" shall mean the copyright owner or entity authorized by"
"      ""Object"" form shall mean any form resulting from mechanical"
"      ""Source"" form shall mean the preferred form for making modifications,"
"      ""Work"" shall mean the work of authorship, whether in Source or"
"      ""You"" (or ""Your"") shall mean an individual or Legal Entity"
"      ""control"" means (i) the power, direct or indirect, to cause the"
"      (c) You must retain, in the Source form of any Derivative Works"
"      (d) If the Work includes a ""NOTICE"" text file as part of its"
"      (except as stated in this section) patent license to make, have made,"
"      Contributor provides its Contributions) on an ""AS IS"" BASIS,"
"      License. However, in accepting such obligations, You may act only"
"      Licensor for the purpose of discussing and improving the Work, but"
"      Notwithstanding the above, nothing herein shall supersede or modify"
"      Object form, made available under the License, as indicated by a"
"      To apply the Apache License to your work, attach the following"
"      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or"
"      Work (including but not limited to damages for loss of goodwill,"
"      Work or Derivative Works thereof in any medium, with or without"
"      agreed to in writing, Licensor provides the Work (and each"
"      and charge a fee for, acceptance of support, warranty, indemnity,"
"      and issue tracking systems that are managed by, or on behalf of, the"
"      boilerplate notice, with the fields enclosed by brackets ""[]"""
"      communication on electronic mailing lists, source code control systems,"
"      control with that entity. For the purposes of this definition,"
"      copyright license to reproduce, prepare Derivative Works of,"
"      defend, and hold each Contributor harmless for any liability"
"      designated in writing by the copyright owner as ""Not a Contribution."""
"      direction or management of such entity, whether by contract or"
"      editorial revisions, annotations, elaborations, or other modifications"
"      for any such Derivative Works as a whole, provided Your use,"
"      for use, reproduction, or distribution of Your modifications, or"
"      form, that is based on (or derived from) the Work and for which the"
"      implied, including, without limitation, any warranties or conditions"
"      incidental, or consequential damages of any character arising as a"
"      including but not limited to software source code, documentation"
"      incurred by, or claims asserted against, such Contributor by reason"
"      liable to You for damages, including any direct, indirect, special,"
"      means any form of electronic, verbal, or written communication sent"
"      modifications, and in Source or Object form, provided that You"
"      names, trademarks, service marks, or product names of the Licensor,"
"      negligent acts) or agreed to in writing, shall any Contributor be"
"      not limited to compiled object code, generated documentation,"
"      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A"
"      of any other Contributor, and only if You agree to indemnify,"
"      of this License, Derivative Works shall not include works that remain"
"      on Your own behalf and on Your sole responsibility, not on behalf"
"      or contributory patent infringement, then any patent licenses"
"      other commercial damages or losses), even if such Contributor"
"      other entities that control, are controlled by, or are under common"
"      otherwise, or (ii) ownership of fifty percent (50%) or more of the"
"      outstanding shares, or (iii) beneficial ownership of such entity."
"      publicly display, publicly perform, sublicense, and distribute the"
"      represent, as a whole, an original work of authorship. For the purposes"
"      reproduction, and distribution of the Work otherwise complies with"
"      same ""printed page"" as the copyright notice for easier"
"      separable from, or merely link (or bind by name) to the interfaces of,"
"      source, and configuration files."
"      the Work or Derivative Works thereof, You may choose to offer,"
"      the copyright owner. For the purposes of this definition, ""submitted"""
"      this License, each Contributor hereby grants to You a perpetual,"
"      this License, without any additional terms or conditions."
"      to that Work or Derivative Works thereof, that is intentionally"
"      to the Licensor or its representatives, including but not limited to"
"      transformation or translation of a Source form, including but"
"      use, offer to sell, sell, import, and otherwise transfer the Work,"
"      whether in tort (including negligence), contract, or otherwise,"
"      work stoppage, computer failure or malfunction, or any and all"
"      worldwide, non-exclusive, no-charge, royalty-free, irrevocable"
"    <ClCompile Include=""CsUtils.cpp"" />"
"    <ClCompile Include=""CsUtils.cpp"">"
"    <ClCompile Include=""HookSentry.cpp"" />"
"    <ClCompile Include=""HookSentry.cpp"">"
"    <ClCompile Include=""SummaryTable.cpp"" />"
"    <ClCompile Include=""SummaryTable.cpp"">"
"    <ClInclude Include=""CsUtils.h"" />"
"    <ClInclude Include=""CsUtils.h"">"
"    <ClInclude Include=""SummaryTable.h"" />"
"    <ClInclude Include=""SummaryTable.h"">"
"    <Filter Include=""File di intestazione"">"
"    <Filter Include=""File di origine"">"
"    <Filter Include=""File di risorse"">"
"    <Import Project=""$(UserRootDir)"
"    <None Include=""README.md"" />"
"    <ProjectConfiguration Include=""Debug"
"    <ProjectConfiguration Include=""Release"
"    <ProjectReference Include=""capstone-5.0.3"
"   5. Submission of Contributions. Unless You explicitly state otherwise,"
"   8. Limitation of Liability. In no event and under no legal theory,"
"   Licensed under the Apache License, Version 2.0 (the ""License"")"
"   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION"
"   Unless required by applicable law or agreed to in writing, software"
"   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."
"   distributed under the License is distributed on an ""AS IS"" BASIS,"
"  <Import Project=""$(VCTargetsPath)"
"  <ImportGroup Label=""ExtensionSettings"">"
"  <ImportGroup Label=""ExtensionTargets"">"
"  <ImportGroup Label=""PropertySheets"" Condition=""'$(Configuration)"
"  <ImportGroup Label=""Shared"">"
"  <ItemDefinitionGroup Condition=""'$(Configuration)"
"  <ItemGroup Label=""ProjectConfigurations"">"
"  <PropertyGroup Condition=""'$(Configuration)"
"  <PropertyGroup Label=""Globals"">"
"  <PropertyGroup Label=""UserMacros"" />"
" Coverlet is a free, cross platform Code Coverage Tool"
" Ignore Visual Studio temporary files, build results, and"
" L""["
" Note: Comment the next line if you want to checkin your web deploy settings,"
" PROCESS_VM_READ, FALSE, pids[count])"
" Since there are multiple workflows, uncomment next line to ignore bower_components"
" checkin your Azure Web App publish settings, but sensitive information contained"
" dirty tool for inspecting system DLLs loaded into processes, looking for functions hooked from AV/EDR."
" except build/, which is used as an MSBuild target."
" or,"
" pids, SIZE_T pidListSize, LPSUMMARY_TABLE table, BOOL verbose, BOOL printDisass)"
" to a newer Visual Studio version. Backup files are not needed,"
" wcscmp(argv[i], L""--all"") == 0)"
" wcscmp(argv[i], L""--disass"") == 0)"
" wcscmp(argv[i], L""--help"") == 0)"
" wcscmp(argv[i], L""--pid"") == 0)"
" wcscmp(argv[i], L""--verbose"") == 0)"
"""                      /"
")mFunctionAddress != 0xE9) { // 'jmp' - no jmp, no hook!"
")startAddr, size, vaAddr, 0, "
", sectionHeader"
"// -a, --all --> Works on all active processes"
"// -d, --disass --> Print disassembled code"
"// -h, --help --> Print Usage"
"// -p <PID>, --pid <pid> --> Work on specific PID"
"// -v, --verbose --> Verbose output"
"1, pidListSize, pids[count])"
"<Project DefaultTargets=""Build"" xmlns=""http://schemas.microsoft.com/developer/msbuild/2003"">"
"<Project ToolsVersion=""4.0"" xmlns=""http://schemas.microsoft.com/developer/msbuild/2003"">"
"BOOL AddSummaryTableRowInfo(LPSUMMARY_TABLE_ROW lpSummaryTableRow, PWSTR pszDllFullPath, DWORD dwHooksCount)"
"DWORD dwFileLen = GetFileSize(hFile, NULL)"
"DWORD processes[1024], cbNeeded, cbProcesses"
"HANDLE hFile = CreateFileW(dllName, GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL)"
"HeapFree(GetProcessHeap(), NULL, pDllImageBase)"
"In addition to scanning individual processes, HookSentry can perform a full scan of all active processes on the system. It can also be used to check a specific process or even scan itself for any hooks."
"It scans for potential hooks in system libraries and provides detailed information about each hook it finds. The tool compares the in-memory image of each DLL with its on-disk version, identifies hooked functions, and prints disassembled code to help analyze the changes."
"LPSUMMARY_TABLE_ROW AddSummaryTableRow(LPSUMMARY_TABLE lpSummaryTable, DWORD dwPid)"
"LPSUMMARY_TABLE_ROW row = AddSummaryTableRow(table, pids[count])"
"Microsoft Visual Studio Solution File, Format Version 12.00"
"Microsoft.Cpp.$(Platform).user.props"" Condition=""exists('$(UserRootDir)"
"Microsoft.Cpp.$(Platform).user.props')"" Label=""LocalAppDataPlatform"" />"
"Microsoft.Cpp.Default.props"" />"
"Microsoft.Cpp.props"" />"
"Microsoft.Cpp.targets"" />"
"PCHAR functionName = RVA2VA(PCHAR, pDllImageBase, RvaToFileOffset(ntHeader, iNames[numberOfNames - 1]))"
"PDWORD iFunctions = RVA2VA(PDWORD, pDllImageBase, RvaToFileOffset(ntHeader, exportDirectory->AddressOfFunctions))"
"PDWORD iNames = RVA2VA(PDWORD, pDllImageBase, RvaToFileOffset(ntHeader, exportDirectory->AddressOfNames))"
"PIMAGE_EXPORT_DIRECTORY exportDirectory = (PIMAGE_EXPORT_DIRECTORY)RVA2VA(ULONG_PTR, pDllImageBase, RvaToFileOffset(ntHeader, exportTableVA))"
"PIMAGE_NT_HEADERS ntHeader = RVA2VA(PIMAGE_NT_HEADERS, pDllImageBase, dosHeader->e_lfanew)"
"PVOID iFunctionAddress = RVA2VA(PVOID, pDllImageBase, RvaToFileOffset(ntHeader, vaFunctionAddress))"
"PVOID mFunctionAddress = RVA2VA(PVOID, ldrEntry.DllBase, vaFunctionAddress)"
"PVOID pDllImageBase = HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, dwFileLen)"
"PVOID pDllImageBase = ReadDllImageBase(hFile, dwFileLen)"
"PWORD iOrdinals = RVA2VA(PWORD, pDllImageBase, RvaToFileOffset(ntHeader, exportDirectory->AddressOfNameOrdinals))"
"PWSTR dllName = GetDllName(remoteProcess, ldrEntry)"
"PrintDisasm(iFunctionAddress, 15, vaFunctionAddress)"
"PrintDisasm(mFunctionAddress, 15, vaFunctionAddress)"
"Project(""{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}"") = ""HookSentry"", ""HookSentry.vcxproj"", ""{CE613FC8-3F97-4989-BC90-2027463EA37D}"""
"Project(""{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}"") = ""capstone_static"", ""capstone-5.0.3"
"ReadLdrData(peb, remoteProcess, "
"ReadLdrEntry(remoteProcess, ldr, "
"ReadProcessMemory(remoteProcess, (PLDR_DATA_TABLE_ENTRY)ldrEntry.Reserved1[0], "
"ReadProcessMemory(remoteProcess, ldr.Reserved2[1], ldrEntry, sizeof(LDR_DATA_TABLE_ENTRY), NULL)"
"ReadProcessMemory(remoteProcess, ldrEntry.FullDllName.Buffer, dllName, ldrEntry.FullDllName.MaximumLength, NULL)"
"ReadProcessMemory(remoteProcess, mFunctionAddress, mFunctionContent, 15, NULL)"
"ReadProcessMemory(remoteProcess, peb->Ldr, ldr, sizeof(PEB_LDR_DATA), NULL)"
"SearchHooksInPIDs(pids, 1, "
"SearchHooksInPIDs(processes, cbProcesses, "
"Win32"">"
"Win32'"" Label=""Configuration"">"
"Win32'"">"
"[submodule ""capstone-5.0.3""]"
"]"" : L""[-]""), row->Pid, row->TotalHooks)"
"capstone_static.vcxproj"", ""{5B01D900-2359-44CA-9914-6B0C6AFB7BE7}"""
"capstone_static.vcxproj"">"
"count = cs_disasm(csHandle, (BYTE"
"cs_free(insn, count)"
"define RVA2VA(TYPE, BASE, RVA) (TYPE)((ULONG_PTR)BASE "
"define SYSTEM_DLL_PATH L""c:"
"define print_verbose(verbose, ...) "
"dwNumberOfBytesRead, NULL) "
"if (!AddSummaryTableRowInfo(tableRow, dllName, hookCount)) {"
"if (!EnumProcesses(processes, sizeof(processes), "
"if (!ReadFile(hFile, pDllImageBase, dwFileLen, "
"if (!ReadProcessMemory(hProcess, processBasicInformation.PebBaseAddress, "
"if (NtQueryInformationProcess(hProcess, ProcessBasicInformation, "
"if (_wcsnicmp(dllName, SYSTEM_DLL_PATH, wcslen(SYSTEM_DLL_PATH)) != 0)"
"if (cs_open(CS_ARCH_X86, CS_MODE_64, "
"if (memcmp(mFunctionAddress, iFunctionAddress, 15) != 0) // 15 byte max instruction length"
"if (wcscmp(argv[i], L""-a"") == 0 "
"if (wcscmp(argv[i], L""-d"") == 0 "
"if (wcscmp(argv[i], L""-h"") == 0 "
"if (wcscmp(argv[i], L""-p"") == 0 "
"if (wcscmp(argv[i], L""-v"") == 0 "
"include ""CsUtils.h"""
"include ""SummaryTable.h"""
"int wmain(int argc, wchar_t"
"ldrEntry, sizeof(LDR_DATA_TABLE_ENTRY), NULL)"
"lpSummaryTable->Rows = (LPSUMMARY_TABLE_ROW)realloc(lpSummaryTable->Rows, (lpSummaryTable->RowsCount "
"lpSummaryTableRow->DllInfos = (LPDLL_INFO)realloc(lpSummaryTableRow->DllInfos, (lpSummaryTableRow->DllsCount "
"memcpy_s(dllName, ldrEntry.FullDllName.MaximumLength, ldrEntry.FullDllName.Buffer, ldrEntry.FullDllName.MaximumLength)"
"n"", (row->TotalHooks > 0 "
"n"", GetLastError())"
"n"", cbProcesses)"
"n"", count"
"n"", dllInfo->DllFullPath)"
"n"", dllInfo->DllFullPath, dllInfo->HooksCount)"
"n"", dllName)"
"n"", functionName)"
"n"", insn[j].address, insn[j].mnemonic, insn[j].op_str)"
"n"", pids[count], GetLastError())"
"n"", tableRow->Pid, dllName, GetLastError())"
"peb, hProcess, row, verbose, printDisass)"
"peb, sizeof(PEB), NULL)) {"
"pragma comment(lib, ""capstone.lib"")"
"pragma comment(lib, ""ntdll"")"
"pragma comment(lib, ""psapi"")"
"print_verbose(verbose, L""["
"printf("""
"printf(""%02X"", "
"printf(""Capstone initialization failed."
"processBasicInformation, sizeof(PROCESS_BASIC_INFORMATION), 0) != 0) {"
"static DWORD RvaToFileOffset(PIMAGE_NT_HEADERS ntHeaders, DWORD rva)"
"static PVOID ReadDllImageBase(HANDLE hFile, DWORD dwFileLen)"
"static PWSTR GetDllName(HANDLE remoteProcess, LDR_DATA_TABLE_ENTRY ldrEntry)"
"static void ReadLdrData(PPEB peb, HANDLE remoteProcess, PEB_LDR_DATA"
"static void ReadLdrEntry(HANDLE remoteProcess, PEB_LDR_DATA ldr, LDR_DATA_TABLE_ENTRY"
"static void SearchHooks(PPEB peb, HANDLE remoteProcess, LPSUMMARY_TABLE_ROW tableRow, BOOL verbose, BOOL printDisass)"
"system32"""
"t-a, --all: Analyze all active processes"
"t-d, --disass: Display disassembled code"
"t-h, --help: Show this message"
"t-p <PID>, --pid <PID>: Analyze the process with PID <PID>"
"t-v, --verbose: Enable verbose output"
"table, verbose)"
"table, verbose, disass)"
"void PrintDisasm(PVOID startAddr, SIZE_T size, DWORD64 vaAddr)"
"void PrintFullTable(LPSUMMARY_TABLE lpSummaryTable, BOOL verbose)"
"wchar_t banner[] = L"""""
"wprintf(L"""
"wprintf(L""%s"", banner)"
"wprintf(L""%ws PID: %d has %d hooked functions"
"wprintf(L""---"
"wprintf(L""Invalid PID."
"wprintf(L""Options:"
"wprintf(L""Usage: HookSentry.exe [-a"
"wprintf(L""[!!!] out of memory"
"wprintf(L""[!] (PID: %d) Failed to get file size: %ws. Error: %lu"
"wprintf(L""[!] (PID: %d) Failed to open file: %ws. Error: %lu"
"wprintf(L""[!] (PID: %d) Failed to read file %ws. Error: %lu"
"wprintf(L""[!] Error reading file. Error: %lu"
"wprintf(L""[!] out of memory"
"wprintf(L""["
"wprintf(L""[-] Failed to enumerate processes."
"wprintf(L""[-] Handle on process %d not obtained. Error: %lu"
"wprintf(L""[-] NtQueryInformationProcess call failed."
"wprintf(L""[-] ReadProcessMemory - Error: %lu."
"x64"">"
"x64'"" Label=""Configuration"">"
"x64'"">"
"xml version=""1.0"" encoding=""utf-8"""
"} DLL_INFO, "
"} SUMMARY_TABLE, "
"} SUMMARY_TABLE_ROW, "
$(Platform)'=='Debug
$(Platform)'=='Release
$tf/
%(AdditionalIncludeDirectories)</AdditionalIncludeDirectories>
%(PreprocessorDefinitions)</PreprocessorDefinitions>
((PBYTE)startAddr 
(BYTE
(PEB_LDR_DATA
(PLDR_DATA_TABLE_ENTRY)(ldr.Reserved2[1])
(PLDR_DATA_TABLE_ENTRY)(ldrEntry.Reserved1[0])
(_)(_)
)(peb->Ldr)
- [ ] Identify jump target
- [ ] Reduce false positives
- [Bb]ackup ([0-9]).rdl
- [Bb]ackup ([0-9][0-9]).rdl
- [Bb]ackup.rdl
- [x] Perform full system scan
-p <PID>
.DesktopClient/GeneratedArtifacts
.DesktopClient/ModelManifest.xml
.DotSettings.user
.GhostDoc.xml
.HTMLClient/GeneratedArtifacts
.HxC
.HxT
.Server/GeneratedArtifacts
.Server/ModelManifest.xml
.VC.VC.opendb
.VC.db
.VisualState.xml
.XML
.[Cc]ache
.[Cc]ache/
.[Pp]ublish.xml
.[Rr]e[Ss]harper
.appx
.appxbundle
.appxupload
.aps
.axoCover/
.azurePubxml
.bim.layout
.bim_
.binlog
.btm.cs
.btp.cs
.build.csdef
.builds
.cab
.cachefile
.code-workspace
.coverage
.coveragexml
.cr/personal
.dbmdl
.dbproj.schemaview
.dotCover
.dsp
.dsw
.e2e
.fake/
.gpState
.hhc
.hhk
.hhp
.history/
.htm
.ilk
.info
.iobj
.ionide/
.ipdb
.jfm
.jmconfig
.json
.ldf
.local.xml
.localhistory/
.log
.mdf
.meta
.mfractor/
.mm.
.msi
.msix
.msm
.msp
.ncb
.ndf
.ntvs_analysis.dat
.nuget.props
.nuget.targets
.nupkg
.nvuser
.obj
.odx.cs
.opendb
.opensdf
.opt
.paket/paket.exe
.pch
.pdb
.pfx
.pgc
.pgd
.pidb
.plg
.psess
.publishproj
.publishsettings
.pubxml
.pyc
.rdl.data
.rptproj.bak
.rptproj.rsuser
.rsp
.rsuser
.sap
.sass-cache/
.sbr
.scc
.sdf
.settings
.sln.docstates
.sln.iml
.snk
.snupkg
.suo
.svclog
.tlb
.tlh
.tli
.tlog
.tmp
.tmp_proj
.tss
.user
.userosscache
.userprefs
.vbp
.vbw
.vs/
.vscode/
.vshistory/
.vsp
.vspscc
.vspx
.vssscc
.xml
.xsd.cs
// DOS Header
// Data Directory
// Export Directory
// Export Table
// Get Function names array
// Get Function ordinals array
// Get Functions addresses array
// NT Header
// Read number of names
// Reads a loader entry from the process memory
// Reads the DLL image base from the file
// Reads the loader data from the process memor
// Retrieves the name of the DLL from the loader entry
// Searches for hooks in the loaded DLLs
/[Pp]ackages/
/[Pp]ackages/build/
/[Pp]ackages/repositories.config
</Project>
<_)(/_
= dwHooksCount
ASALocalRun/
Apache License
AppPackages/
AutoTest.Net/
BOOL disass = FALSE
BOOL fullScan = FALSE
BOOL verbose = FALSE
BYTE mFunctionContent[15]
Backup
BenchmarkDotNet.Artifacts/
Bitdefender
Bitdefender Security
BundleArtifacts/
ClientBin/
CloseHandle(hFile)
CloseHandle(hProcess)
DWORD DllsCount
DWORD HooksCount
DWORD Pid
DWORD RowsCount
DWORD TotalHooks
DWORD dwNumberOfBytesRead
DWORD exportTableVA = dataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress
DWORD hookCount = 0
DWORD numberOfNames = exportDirectory->NumberOfNames
DWORD pids[] = { GetCurrentProcessId() }
DWORD pids[] = { pid }
DWORD sectionAddress = sectionHeader->VirtualAddress
DWORD sectionSize = sectionHeader->Misc.VirtualSize
DWORD vaFunctionAddress = iFunctions[iOrdinals[numberOfNames - 1]]
Debug
Desktop>.
DocProject/Help/
DocProject/Help/Html2
DocProject/Help/html
DocProject/buildhelp/
EndGlobal
EndGlobalSection
EndProject
FakesAssemblies/
FodyWeavers.xsd
FreeSummaryTable(
Generated
Generated_Code/
Global
GlobalSection(ProjectConfigurationPlatforms) = postSolution
GlobalSection(SolutionConfigurationPlatforms) = preSolution
GlobalSection(SolutionProperties) = preSolution
HANDLE hProcess
HideSolutionNode = FALSE
HookSentry is a quick 
HookSentry is still under development! Next steps:
HookSentry.exe -h
HookSentry.exe -v -d
InitSummaryTable(
KERNEL32.DLL contains 8 hooks
KERNELBASE.dll contains 45 hooks
LDR_DATA_TABLE_ENTRY ldrEntry
LPDLL_INFO DllInfos
LPDLL_INFO dllInfo = 
LPDLL_INFO newDll = 
LPSUMMARY_TABLE_ROW Rows
LPSUMMARY_TABLE_ROW newRow = 
LPSUMMARY_TABLE_ROW row = 
MigrationBackup/
MinimumVisualStudioVersion = 10.0.40219.1
NDEBUG
OpenCover/
Options:
PEB peb
PEB_LDR_DATA ldr
PIMAGE_DATA_DIRECTORY dataDirectory = (PIMAGE_DATA_DIRECTORY)ntHeader->OptionalHeader.DataDirectory
PIMAGE_DOS_HEADER dosHeader = (PIMAGE_DOS_HEADER)pDllImageBase
PIMAGE_SECTION_HEADER sectionHeader = IMAGE_FIRST_SECTION(ntHeaders)
PROCESS_BASIC_INFORMATION processBasicInformation
PWSTR DllFullPath
PWSTR dllName = (PWSTR)malloc(ldrEntry.FullDllName.MaximumLength)
Package.StoreAssociation.xml
PrintFullTable(
PrintUsage()
Program Files
PublishScripts/
Release
SUMMARY_TABLE table
SYSTEM32
ScaffoldingReadMe.txt
SearchHooks(
ServiceFabricBackup/
StyleCopReport.xml
System32
TestResult.xml
The tool is only compatible with x64 systems.
UpgradeLog
Usage: HookSentry.exe [-a
Users
V0.3 - 2024 - @Umarex
VCRUNTIME140.dll
VisualStudioVersion = 17.12.35506.116 d17.12
Win32
Windows
[...]
[Aa][Rr][Mm]/
[Aa][Rr][Mm]64/
[Bb]in/
[Bb]uild[Ll]og.
[Dd]ebug/
[Dd]ebugPS/
[Dd]ebugPublic/
[Ee]xpress/
[Ll]og/
[Ll]ogs/
[Oo]bj/
[Rr]elease/
[Rr]eleasePS/
[Rr]eleases/
[Tt]est[Rr]esult
[Ww][Ii][Nn]32/
] %d active processes found
] %s not a system library. skipped.
] C:
] Full system scan requested (could take a while)
] Function %s HOOKED!
] Function ZwWriteVirtualMemory HOOKED!
] PID: 2120 has 139 hooked functions
] Selected current process.
] Working on process %d of %llu with PID: %d
] Working on process 1 of 1 with PID: 2120
] Working on: %s
] Working on: C:
_CONSOLE
_Chutzpah
_DEBUG
_NCrunch_
_Pvt_Extensions
_ReSharper
_TeamCity
_UpgradeReport_Files/
__pycache__/
_h.h
_i.c
_p.c
_pkginfo.txt
_wpftmp.csproj
artifacts/
asmx</Extensions>
atcuf
atcuf64.dll not a system library. skipped.
bdhkm
bdhkm64.dll not a system library. skipped.
bld/
bower_components/
break
capstone
capstone_static
cbNeeded))
cbProcesses = cbNeeded / sizeof(DWORD)
continue
coverage
cppm
crunch
csHandle)
csHandle) != CS_ERR_OK)
cs_close(
cs_insn
csh csHandle
csx/
disass = TRUE
dlldata.c
dlls_266864023745032704
dlls_267396668276705800
do { 
ecf/
else
else if (!fullScan 
else if (fullScan)
exit(1)
for (
for (DWORD count = 0
for (DWORD i = 0
for (DWORD j = 0
for (DWORD k = 0
for (int i = 0
for (size_t j = 0
free(dllName)
free(lpSummaryTable->Rows)
free(row->DllInfos)
free(row->DllInfos[j].DllFullPath)
fullScan = TRUE
hProcess = OpenProcess(PROCESS_QUERY_INFORMATION 
healthchecksdb
hookCount
if (
if (!fullScan 
if (!hFile 
if (!hProcess) {
if (count > 0)
if (dllInfo->HooksCount == -1)
if (dllName == NULL)
if (dwFileLen == INVALID_FILE_SIZE)
if (hookCount > 0) {
if (ldrEntry.DllBase == NULL)
if (lpSummaryTable->Rows == NULL)
if (lpSummaryTableRow->DllInfos == NULL)
if (pDllImageBase == NULL)
if (pid == 0) {
if (printDisass)
if (remoteProcess != NULL)
if (remoteProcess != NULL) {
if (row == NULL) {
if (rva >= sectionAddress 
if (verbose)
if(verbose) { 
include
include <capstone.h>
include <psapi.h>
include <stdio.h>
include <wchar.h>
include <windows.h>
include <winternl.h>
insn)
int pid = 0
ipch/
issue-259490424)
issuecomment-104372622)
jpeg
ldr = 
ldr)
ldrEntry = 
ldrEntry)
lpSummaryTable->Rows = NULL
lpSummaryTable->RowsCount
lpSummaryTable->RowsCount = 0
lpSummaryTable->Rows[i]
lpSummaryTable->Rows[lpSummaryTable->RowsCount]
lpSummaryTableRow->DllInfos[lpSummaryTableRow->DllsCount]
lpSummaryTableRow->DllsCount
lpSummaryTableRow->TotalHooks 
mFunctionAddress = mFunctionContent
mfcribbon-ms</Extensions>
mono_crash.
msvc
nCrunchTemp_
nV0.3 - 2024 - @Umarex
newDll->DllFullPath = pszDllFullPath
newDll->HooksCount = dwHooksCount
newRow->DllInfos = NULL
newRow->DllsCount = 0
newRow->Pid = dwPid
newRow->TotalHooks = 0
node_modules/
ntdll.dll
ntdll.dll contains 86 hooks
numberOfNames--
nunit-
orleans.codegen.cs
paket-files/
path = capstone-5.0.3
pid = _wtoi(argv[i 
pragma once
project.fragment.lock.json
project.lock.json
publish/
rcf/
resx
return
return 0
return 1
return FALSE
return NULL
return TRUE
return dllName
return newRow
return pDllImageBase
return rva - sectionAddress 
row->DllInfos[k]
size_t count
static void PrintUsage()
static void SearchHooksInPIDs(DWORD
t%s contains %d hooks
t%s skipped.
t(ERROR: Failed to disassemble given code!)
t0x%llX:
tFunction in memory:
tFunction on disk:
table)
tiff
typedef struct {
ucrtbase.dll
url = git@github.com:capstone-engine/capstone.git
user
verbose = TRUE
void FreeSummaryTable(LPSUMMARY_TABLE lpSummaryTable)
void InitSummaryTable(LPSUMMARY_TABLE lpSummaryTable)
while (numberOfNames > 0)
windows
wprintf(__VA_ARGS__)
wwwroot/
x64 = Debug
x64 = Release
x64.ActiveCfg = Debug
x64.ActiveCfg = Release
x64.Build.0 = Debug
x64.Build.0 = Release
x64/
x86 = Debug
x86 = Release
x86.ActiveCfg = Debug
x86.ActiveCfg = Release
x86.Build.0 = Debug
x86.Build.0 = Release
x86/
xsd</Extensions>
{5B01D900-2359-44CA-9914-6B0C6AFB7BE7}.Debug
{5B01D900-2359-44CA-9914-6B0C6AFB7BE7}.Release
{CE613FC8-3F97-4989-BC90-2027463EA37D}.Debug
{CE613FC8-3F97-4989-BC90-2027463EA37D}.Release
} while(0) 
